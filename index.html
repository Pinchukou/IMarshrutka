<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>109 Маршрутка - Knight</title>
    <style id="theme-style">
        :root {
            --bg-color: #ffffff;
            --card-bg: #ffffff;
            --accent-color: #000000;
            --text-color: #000000;
            --border-width: 5px;
            --border-radius: 0px;
            --shadow-offset: 8px;
            --font-main: 'Courier New', Courier, monospace;
            --line-style: solid;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                border-color 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                color 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                box-shadow 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                border-radius 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        html {
            min-height: 100%;
            background-color: var(--bg-color);
            background-attachment: fixed;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            padding: calc(20px + env(safe-area-inset-top)) 20px calc(25px + env(safe-area-inset-bottom));
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            background-attachment: fixed;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .header-container {
            text-align: center;
            margin-bottom: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .mascot-container {
            animation: jump 2s infinite alternate cubic-bezier(0.5, 0.05, 1, 0.5);
            margin-bottom: 5px;
        }

        @keyframes jump {
            0% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(-15px);
            }
        }

        .mascot-img {
            width: 200px;
            /* Reduced from 280px */
            height: auto;
            display: block;
            cursor: pointer;
            transform-origin: bottom center;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .mascot-img:active {
            transform: scale(0.8) rotate(-5deg);
        }

        @keyframes mascot-switch {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2) rotate(10deg);
            }

            100% {
                transform: scale(1);
            }
        }

        .mascot-animate {
            animation: mascot-switch 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }



        .app-container {
            width: 100%;
            max-width: 500px;
        }

        .neo-box {
            background-color: var(--card-bg);
            border: var(--border-width) var(--line-style) var(--text-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-offset) var(--shadow-offset) 0px 0px var(--text-color);
            padding: 20px;
            /* Reduced padding */
            margin-bottom: 25px;
            /* Reduced margin */
            width: 100%;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .neo-box:active {
            transform: translate(2px, 2px);
            box-shadow: calc(var(--shadow-offset) - 2px) calc(var(--shadow-offset) - 2px) 0px 0px var(--text-color);
        }

        .card-header {
            text-align: center;
            margin-bottom: 5px;
            padding-bottom: 10px;
            border: none;
            border-bottom: none;
        }

        .card-title {
            font-weight: 900;
            font-size: 1.5rem;
            text-transform: uppercase;
            border: none;
            text-decoration: none;
        }

        .countdown-large {
            font-size: 7rem;
            font-weight: 900;
            line-height: 0.8;
            text-align: center;
            display: block;
            margin: 5px 0;
            /* Reduced margin */
        }

        .countdown-label {
            font-size: 1.6rem;
            font-weight: bold;
            text-align: center;
            display: block;
        }

        .time-exact {
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
            display: block;
            margin-top: 10px;
        }

        .schedule-expandable {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out, opacity 0.3s;
            opacity: 0;
        }

        .schedule-expandable.open {
            max-height: 1200px;
            opacity: 1;
            margin-top: 25px;
            padding-top: 0px;
        }



        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            /* 3 columns for better fit with labels */
            gap: 8px;
        }

        .time-slot {
            border: 2px solid var(--text-color);
            padding: 5px;
            text-align: center;
            font-weight: bold;
            background: #fff;
            font-size: 0.9rem;
            color: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50px;
        }

        .slot-day-label {
            font-size: 0.6rem;
            font-weight: normal;
            opacity: 0.8;
            margin-top: 2px;
        }

        .time-slot.past {
            opacity: 0.3;
        }

        /* Style for schedule items not running TODAY */
        .time-slot.not-today {
            opacity: 0.4;
            background: #eee;
            border-style: dashed;
        }

        .time-slot.next {
            background: var(--text-color);
            color: #fff;
            position: relative;
            z-index: 1;
            box-shadow: 0 0 0 2px var(--text-color);
        }

        .time-previous {
            font-size: 0.8rem;
            /* Compact size */
            font-weight: bold;
            text-align: center;
            display: block;
            margin-bottom: 2px;
            opacity: 0.6;
            min-height: 1.2em;
        }

        /* Theme overrides for previous time */
        body[data-theme="Apple"] .time-previous {
            color: #fff;
        }

        body[data-theme="Punk"] .time-previous {
            color: #000;
        }

        body[data-theme="Nokia"] .time-previous {
            color: #43523d;
            font-family: 'VT323', monospace;
        }

        /* Adjust Apple grid for new item size */
        body[data-theme="Apple"] .schedule-grid {
            grid-template-columns: repeat(3, 1fr);
        }

        /* Font Import for Nokia Theme */
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        @media (max-width: 450px) {
            h1 {
                font-size: 3.5rem;
            }

            .countdown-large {
                font-size: 5rem;
            }

            .schedule-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .time-previous {
                margin-bottom: 10px;
                font-size: 0.75rem;
            }
        }

        /* iPhone Pro Max optimizations */
        @media (max-width: 500px) {
            body[data-theme="Aero"]::before {
                background-image:
                    radial-gradient(circle at 8% 15%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 3%, transparent 5%),
                    radial-gradient(circle at 92% 10%, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.3) 4%, transparent 6%),
                    radial-gradient(circle at 75% 35%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 5%, transparent 7%),
                    radial-gradient(circle at 20% 55%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 3%, transparent 5%),
                    radial-gradient(circle at 85% 50%, rgba(255, 255, 255, 0.7) 0%, rgba(255, 255, 255, 0.2) 4%, transparent 6%),
                    radial-gradient(circle at 15% 85%, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.5) 3%, transparent 5%),
                    radial-gradient(circle at 60% 75%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 4%, transparent 6%),
                    radial-gradient(circle at 40% 25%, rgba(255, 255, 255, 0.75) 0%, rgba(255, 255, 255, 0.25) 5%, transparent 7%),
                    radial-gradient(circle at 95% 90%, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.4) 4%, transparent 6%),
                    radial-gradient(circle at 50% 95%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 3%, transparent 5%);
            }
        }

        /* Apple Theme Specific Overrides */
        body[data-theme="Apple"] {
            /* Sky/Cloudy background suggestion from user image */
            background: linear-gradient(180deg, #A1C4FD 0%, #C2E9FB 100%);
        }

        body[data-theme="Apple"] .neo-box {
            border: 2px solid #000;
            overflow: hidden;
            padding: 0;
            /* Remove padding so header touches edges */
            display: flex;
            flex-direction: column;
        }

        body[data-theme="Apple"] .card-header {
            background: #ffffff;
            color: #000000;
            position: relative;
            padding: 12px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 2px solid #000;
            width: 100%;
            /* Full width */
            flex-shrink: 0;
        }

        /* Mac Window Dots */
        body[data-theme="Apple"] .card-header::before {
            content: "";
            position: absolute;
            left: 15px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff5f56;
            box-shadow: 20px 0 0 #ffbd2e, 40px 0 0 #27c93f;
        }

        body[data-theme="Apple"] .card-title {
            color: #000000;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1.2rem;
            letter-spacing: 1px;
            border: none;
        }

        body[data-theme="Apple"] .countdown-container {
            padding: 10px 20px 20px 20px;
            /* Reduced top padding */
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* Ensure expandable schedule also has padding if needed, or keeping it flush */
        body[data-theme="Apple"] .schedule-expandable {
            background: transparent;
        }

        body[data-theme="Apple"] .schedule-grid {
            padding: 15px;
        }

        /* Ensure text inside the blue card is white */
        body[data-theme="Apple"] .countdown-label,
        body[data-theme="Apple"] .time-exact,
        body[data-theme="Apple"] .time-slot {
            color: #ffffff;
            border-color: #ffffff;
        }

        body[data-theme="Apple"] .time-slot {
            background: rgba(255, 255, 255, 0.2);
        }

        body[data-theme="Apple"] .time-slot.next {
            background: #ffffff;
            color: #2b5cb5;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        /* Punk Theme Overrides */
        body[data-theme="Punk"] {
            background-color: #dd89ec;
            /* Solid Purple/Pink */
            background-image: none;
            position: relative;
        }

        /* Background effects removed as requested */

        body[data-theme="Punk"] .neo-box {
            border: 3px solid #000;
            box-shadow: 8px 8px 0px #000;
            border-radius: 12px;
            background-color: #fabb5b !important;
            /* All cards orange */
            color: #000;
        }

        /* Ensure specific card overrides don't conflict */
        body[data-theme="Punk"] #card-to_gomel,
        body[data-theme="Punk"] #card-from_gomel {
            background-color: #fabb5b;
            color: #000;
        }

        body[data-theme="Punk"] .card-title {
            font-family: 'Arial Black', 'Helvetica Black', 'Arial', sans-serif;
            font-weight: 900;
            text-transform: uppercase;
            font-size: 1.4rem;
            color: #000;
        }

        body[data-theme="Punk"] .countdown-large {
            font-family: 'Arial Black', 'Helvetica Black', 'Arial', sans-serif;
            font-weight: 900;
            color: #000;
            letter-spacing: -2px;
        }

        body[data-theme="Punk"] .time-slot {
            border: 2px solid #000;
            background: #fff;
            color: #000;
            font-weight: bold;
        }

        body[data-theme="Punk"] .time-slot.next {
            background: #000;
            color: #fff;
            box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.2);
        }

        /* Nokia 3310 Theme Overrides */
        body[data-theme="Nokia"] {
            background-color: #c4d79b;
            /* Classic Nokia Green */
            font-family: 'VT323', monospace;
            position: relative;
        }

        /* Nokia Pixel Grid Effect */
        body[data-theme="Nokia"]::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(rgba(0, 0, 0, 0.08) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.08) 1px, transparent 1px);
            background-size: 4px 4px;
            z-index: 10;
            pointer-events: none;
        }

        body[data-theme="Nokia"] .neo-box {
            background-color: #c4d79b;
            border: 4px solid #43523d;
            /* Dark Green Border */
            color: #43523d;
            box-shadow: none;
            /* Flat look */
            border-radius: 0;
            position: relative;
        }

        /* Pixelated Corners (pseudo-elements) */
        body[data-theme="Nokia"] .neo-box::before {
            content: "Signal";
            position: absolute;
            top: 2px;
            left: 5px;
            font-size: 10px;
            opacity: 0.7;
        }

        body[data-theme="Nokia"] .neo-box::after {
            content: "100%";
            position: absolute;
            top: 2px;
            right: 5px;
            font-size: 10px;
            opacity: 0.7;
        }

        body[data-theme="Nokia"] .card-header {
            border-bottom: 2px dashed #43523d;
            margin-bottom: 5px;
        }

        body[data-theme="Nokia"] .countdown-container {
            padding-top: 5px;
        }

        body[data-theme="Nokia"] .card-title,
        body[data-theme="Nokia"] .countdown-large,
        body[data-theme="Nokia"] .countdown-label,
        body[data-theme="Nokia"] .time-exact {
            font-family: 'VT323', monospace;
            color: #43523d;
            /* Dark Green Text */
            text-transform: uppercase;
        }

        body[data-theme="Nokia"] .countdown-large {
            font-size: 6.5rem;
            /* Middle ground for iPhone */
            letter-spacing: -2px;
        }

        body[data-theme="Nokia"] .neo-box {
            padding: 15px;
            /* Compacted */
        }

        body[data-theme="Nokia"] .time-slot {
            border: 2px solid #43523d;
            background: #c4d79b;
            color: #43523d;
            font-family: 'VT323', monospace;
            box-shadow: 2px 2px 0 #43523d;
        }

        body[data-theme="Nokia"] .time-slot.past {
            opacity: 0.4;
            text-decoration: line-through;
        }

        body[data-theme="Nokia"] .time-slot.next {
            background: #43523d;
            color: #c4d79b;
            box-shadow: none;
            transform: none;
            border: 2px solid #000;
        }

        /* ===== AERO THEME (Frutiger Aero / Liquid Glass) ===== */
        body[data-theme="Aero"] {
            background: #87CEEB;
            /* Solid Sky Blue */
            background-attachment: fixed;
            position: relative;
            overflow-x: hidden;
        }

        /* Floating bubbles decoration - LOTS of them */
        body[data-theme="Aero"]::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                /* Row 1 - Top */
                radial-gradient(circle at 5% 5%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2%, transparent 4%),
                radial-gradient(circle at 20% 8%, rgba(255, 255, 255, 0.7) 0%, rgba(255, 255, 255, 0.3) 3%, transparent 5%),
                radial-gradient(circle at 35% 3%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.3) 2%, transparent 4%),
                radial-gradient(circle at 55% 10%, rgba(255, 255, 255, 0.6) 0%, rgba(255, 255, 255, 0.2) 4%, transparent 6%),
                radial-gradient(circle at 75% 5%, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.4) 2%, transparent 4%),
                radial-gradient(circle at 92% 8%, rgba(255, 255, 255, 0.75) 0%, rgba(255, 255, 255, 0.3) 3%, transparent 5%),
                /* Row 2 */
                radial-gradient(circle at 8% 22%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.35) 3%, transparent 5%),
                radial-gradient(circle at 28% 18%, rgba(255, 255, 255, 0.65) 0%, rgba(255, 255, 255, 0.25) 4%, transparent 6%),
                radial-gradient(circle at 48% 25%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2%, transparent 4%),
                radial-gradient(circle at 68% 20%, rgba(255, 255, 255, 0.7) 0%, rgba(255, 255, 255, 0.3) 3%, transparent 5%),
                radial-gradient(circle at 88% 24%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.35) 2%, transparent 4%),
                /* Row 3 */
                radial-gradient(circle at 12% 38%, rgba(255, 255, 255, 0.75) 0%, rgba(255, 255, 255, 0.3) 3%, transparent 5%),
                radial-gradient(circle at 32% 35%, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.4) 2%, transparent 4%),
                radial-gradient(circle at 52% 42%, rgba(255, 255, 255, 0.6) 0%, rgba(255, 255, 255, 0.2) 4%, transparent 6%),
                radial-gradient(circle at 72% 38%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2%, transparent 4%),
                radial-gradient(circle at 95% 40%, rgba(255, 255, 255, 0.7) 0%, rgba(255, 255, 255, 0.3) 3%, transparent 5%),
                /* Row 4 */
                radial-gradient(circle at 3% 55%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.35) 2%, transparent 4%),
                radial-gradient(circle at 22% 52%, rgba(255, 255, 255, 0.65) 0%, rgba(255, 255, 255, 0.25) 4%, transparent 6%),
                radial-gradient(circle at 42% 58%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2%, transparent 4%),
                radial-gradient(circle at 62% 54%, rgba(255, 255, 255, 0.75) 0%, rgba(255, 255, 255, 0.3) 3%, transparent 5%),
                radial-gradient(circle at 82% 58%, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.4) 2%, transparent 4%),
                /* Row 5 */
                radial-gradient(circle at 10% 72%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2%, transparent 4%),
                radial-gradient(circle at 30% 68%, rgba(255, 255, 255, 0.7) 0%, rgba(255, 255, 255, 0.3) 3%, transparent 5%),
                radial-gradient(circle at 50% 75%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.35) 2%, transparent 4%),
                radial-gradient(circle at 70% 70%, rgba(255, 255, 255, 0.65) 0%, rgba(255, 255, 255, 0.25) 4%, transparent 6%),
                radial-gradient(circle at 90% 74%, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.4) 2%, transparent 4%),
                /* Row 6 - Bottom */
                radial-gradient(circle at 5% 88%, rgba(255, 255, 255, 0.75) 0%, rgba(255, 255, 255, 0.3) 3%, transparent 5%),
                radial-gradient(circle at 25% 92%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2%, transparent 4%),
                radial-gradient(circle at 45% 85%, rgba(255, 255, 255, 0.7) 0%, rgba(255, 255, 255, 0.3) 3%, transparent 5%),
                radial-gradient(circle at 65% 90%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.35) 2%, transparent 4%),
                radial-gradient(circle at 85% 88%, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.4) 2%, transparent 4%),
                radial-gradient(circle at 98% 95%, rgba(255, 255, 255, 0.7) 0%, rgba(255, 255, 255, 0.3) 3%, transparent 5%);
            z-index: 0;
            pointer-events: none;
            animation: bubbleFloat 20s ease-in-out infinite;
        }

        @keyframes bubbleFloat {

            0%,
            100% {
                transform: translateY(0) scale(1);
            }

            50% {
                transform: translateY(-10px) scale(1.02);
            }
        }

        /* Glossy Liquid Plastic Cards */
        body[data-theme="Aero"] .neo-box {
            background: linear-gradient(180deg,
                    rgba(0, 191, 255, 0.85) 0%,
                    rgba(30, 144, 255, 0.9) 50%,
                    rgba(0, 100, 200, 0.95) 100%) !important;
            border: 3px solid rgba(255, 255, 255, 0.6);
            border-radius: 25px;
            box-shadow:
                0 15px 35px rgba(0, 50, 100, 0.4),
                0 5px 15px rgba(0, 0, 0, 0.2),
                inset 0 2px 0 rgba(255, 255, 255, 0.5),
                inset 0 -2px 0 rgba(0, 0, 0, 0.1);
            overflow: hidden;
            padding: 0;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Specular highlight on top */
        body[data-theme="Aero"] .neo-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 45%;
            background: linear-gradient(180deg,
                    rgba(255, 255, 255, 0.7) 0%,
                    rgba(255, 255, 255, 0.3) 30%,
                    rgba(255, 255, 255, 0) 100%);
            border-radius: 22px 22px 50% 50%;
            pointer-events: none;
            z-index: 1;
        }

        /* Secondary reflection */
        body[data-theme="Aero"] .neo-box::after {
            content: "";
            position: absolute;
            bottom: 5%;
            left: 10%;
            width: 80%;
            height: 20%;
            background: radial-gradient(ellipse at center, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
            pointer-events: none;
            z-index: 1;
        }

        body[data-theme="Aero"] .card-header {
            background: linear-gradient(180deg,
                    rgba(50, 205, 50, 0.95) 0%,
                    /* Lime green */
                    rgba(34, 139, 34, 0.95) 100%
                    /* Forest green */
                );
            padding: 18px 0;
            margin: 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.5);
            width: 100%;
            position: relative;
            z-index: 3;
            box-shadow:
                inset 0 15px 20px rgba(255, 255, 255, 0.4),
                inset 0 -3px 10px rgba(0, 0, 0, 0.2);
        }

        /* Green header gloss */
        body[data-theme="Aero"] .card-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.5) 0%, rgba(255, 255, 255, 0) 100%);
            border-radius: 22px 22px 50% 50%;
            pointer-events: none;
        }

        body[data-theme="Aero"] .card-title {
            font-family: 'Gill Sans', 'Trebuchet MS', 'Segoe UI', sans-serif;
            font-weight: 900;
            color: #fff;
            text-shadow:
                0 2px 0 rgba(0, 100, 0, 0.5),
                0 0 10px rgba(255, 255, 255, 0.5);
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        body[data-theme="Aero"] .countdown-container {
            padding: 25px 20px 20px 20px;
            flex-grow: 1;
            position: relative;
            z-index: 2;
        }

        body[data-theme="Aero"] .countdown-large {
            font-family: 'Gill Sans', 'Trebuchet MS', sans-serif;
            color: #fff;
            text-shadow:
                0 3px 0 rgba(0, 50, 100, 0.6),
                0 0 20px rgba(255, 255, 255, 0.4);
            font-weight: 900;
        }

        body[data-theme="Aero"] .countdown-label,
        body[data-theme="Aero"] .time-exact,
        body[data-theme="Aero"] .time-previous {
            color: #fff;
            font-family: 'Gill Sans', 'Trebuchet MS', sans-serif;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        body[data-theme="Aero"] .schedule-grid {
            padding: 10px 15px 15px 15px;
            gap: 8px;
        }

        body[data-theme="Aero"] .time-slot {
            background: #ADD8E6;
            /* Solid Light Blue */
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            color: #003366;
            font-weight: bold;
            box-shadow:
                inset 0 3px 5px rgba(255, 255, 255, 0.5),
                0 2px 5px rgba(0, 0, 0, 0.15);
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        body[data-theme="Aero"] .time-slot.next {
            background: #7CFC00;
            /* Solid Lawn Green */
            color: #fff;
            border: 2px solid rgba(255, 255, 255, 0.7);
            box-shadow:
                0 0 20px rgba(50, 205, 50, 0.6),
                inset 0 5px 10px rgba(255, 255, 255, 0.5),
                0 4px 10px rgba(0, 0, 0, 0.3);
            text-shadow: 0 2px 0 rgba(0, 80, 0, 0.5);
            font-weight: 900;
        }

        body[data-theme="Aero"] .time-slot.past {
            opacity: 0.3;
        }

        body[data-theme="Aero"] .time-slot.not-today {
            opacity: 0.2;
        }

        /* ===== РАСКРАСКА THEME (Neobrutalism / Coloring Book) ===== */
        body[data-theme="Raskraska"] {
            background: #fff0db;
            /* Warm cream/beige */
            position: relative;
            overflow-x: hidden;
        }

        body[data-theme="Raskraska"] .neo-box {
            border: 4px solid #1a1a2e !important;
            border-radius: 20px;
            box-shadow: 6px 6px 0 #1a1a2e;
            overflow: hidden;
            padding: 0;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* First card - Orange/Peach */
        body[data-theme="Raskraska"] .neo-box:nth-child(1) {
            background: #fabb5b !important;
        }

        /* Second card - Pink/Coral */
        body[data-theme="Raskraska"] .neo-box:nth-child(2) {
            background: #ff8fab !important;
        }

        body[data-theme="Raskraska"] .card-header {
            background: #55d6be;
            /* Mint/Teal */
            padding: 14px 0;
            margin: 0;
            border-bottom: 3px solid #1a1a2e;
            width: 100%;
            position: relative;
        }

        body[data-theme="Raskraska"] .neo-box:nth-child(2) .card-header {
            background: #ffeaa7;
            /* Yellow for second card */
        }

        body[data-theme="Raskraska"] .card-title {
            font-family: 'Chalkboard SE', 'Comic Sans MS', cursive, sans-serif;
            font-weight: 700;
            color: #1a1a2e;
            text-shadow: none;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        body[data-theme="Raskraska"] .countdown-container {
            padding: 20px;
            flex-grow: 1;
        }

        body[data-theme="Raskraska"] .countdown-large {
            font-family: 'Chalkboard SE', 'Comic Sans MS', cursive, sans-serif;
            color: #1a1a2e;
            text-shadow: 2px 2px 0 rgba(255, 255, 255, 0.5);
            font-weight: 700;
        }

        body[data-theme="Raskraska"] .countdown-label,
        body[data-theme="Raskraska"] .time-exact,
        body[data-theme="Raskraska"] .time-previous {
            color: #1a1a2e;
            font-family: 'Chalkboard SE', 'Comic Sans MS', 'Comic Sans', cursive, sans-serif;
            font-weight: 600;
        }

        body[data-theme="Raskraska"] .schedule-grid {
            padding: 12px 15px 15px 15px;
            gap: 8px;
        }

        body[data-theme="Raskraska"] .time-slot {
            background: #fff5e6;
            border: 3px solid #1a1a2e;
            border-radius: 10px;
            color: #1a1a2e;
            font-weight: 700;
            font-family: 'Chalkboard SE', 'Comic Sans MS', 'Comic Sans', cursive, sans-serif;
            box-shadow: 3px 3px 0 #1a1a2e;
        }

        /* Alternating slot colors */
        body[data-theme="Raskraska"] .time-slot:nth-child(3n+1) {
            background: #a8e6cf;
            /* Mint green */
        }

        body[data-theme="Raskraska"] .time-slot:nth-child(3n+2) {
            background: #ffd3b6;
            /* Peach */
        }

        body[data-theme="Raskraska"] .time-slot:nth-child(3n) {
            background: #dcedc1;
            /* Light green */
        }

        body[data-theme="Raskraska"] .time-slot.next {
            background: #ff6b6b !important;
            /* Coral red */
            color: #fff;
            border: 3px solid #1a1a2e;
            box-shadow: 4px 4px 0 #1a1a2e;
            transform: rotate(-1deg);
        }

        body[data-theme="Raskraska"] .time-slot.past {
            opacity: 0.4;
            box-shadow: 2px 2px 0 #1a1a2e;
        }

        body[data-theme="Raskraska"] .time-slot.not-today {
            opacity: 0.25;
        }

        /* ===== OLD COMPUTER THEME (Retro Pager / CRT) ===== */
        body[data-theme="OldComputer"] {
            background: #1a1040;
            /* Deep purple */
            position: relative;
            overflow-x: hidden;
        }

        /* Scanlines effect */
        body[data-theme="OldComputer"]::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(0deg,
                    rgba(0, 0, 0, 0.15) 0px,
                    rgba(0, 0, 0, 0.15) 1px,
                    transparent 1px,
                    transparent 3px);
            z-index: 1000;
            pointer-events: none;
        }

        /* CRT flicker animation */
        body[data-theme="OldComputer"]::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(100, 80, 180, 0.03);
            z-index: 999;
            pointer-events: none;
            animation: crt-flicker 0.1s infinite;
        }

        @keyframes crt-flicker {
            0% {
                opacity: 0.97;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.98;
            }
        }

        /* Pager-style cards */
        body[data-theme="OldComputer"] .neo-box {
            background: #6b5b95 !important;
            /* Muted purple plastic */
            border: 4px solid #4a3f6b !important;
            border-radius: 8px;
            box-shadow:
                inset 2px 2px 0 #8677a9,
                inset -2px -2px 0 #3d3357,
                4px 4px 0 rgba(0, 0, 0, 0.5);
            overflow: hidden;
            padding: 0;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        body[data-theme="OldComputer"] .card-header {
            background: #5a4d7a;
            padding: 10px 0;
            margin: 0;
            border-bottom: 3px solid #3d3357;
            width: 100%;
            position: relative;
        }

        body[data-theme="OldComputer"] .card-title {
            font-family: 'Menlo', 'Arial Black', 'Helvetica Neue', sans-serif;
            font-weight: 900;
            color: #3d3357;
            /* Darker than background - engraved into plastic */
            text-shadow:
                1px 1px 0 #8677a9,
                /* Light highlight below/right */
                -1px -1px 0 #2a2040;
            /* Dark shadow above/left - creates depth */
            letter-spacing: 4px;
            text-transform: uppercase;
            font-size: 0.95rem;
        }

        /* Green phosphor screen area */
        body[data-theme="OldComputer"] .countdown-container {
            background: #0a2a2a;
            /* Dark teal/green CRT */
            margin: 8px;
            padding: 15px;
            border-radius: 4px;
            border: 3px solid #072020;
            box-shadow:
                inset 0 0 30px rgba(0, 255, 100, 0.1),
                inset 0 0 10px rgba(0, 0, 0, 0.8);
            flex-grow: 1;
        }

        body[data-theme="OldComputer"] .countdown-large {
            font-family: 'Menlo', 'Courier', monospace;
            color: #4ade80;
            /* Green phosphor */
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
            font-weight: 400;
            letter-spacing: 5px;
        }

        body[data-theme="OldComputer"] .countdown-label {
            color: #4ade80;
            font-family: 'Menlo', 'VT323', monospace;
            text-shadow: 0 0 5px rgba(74, 222, 128, 0.3);
            letter-spacing: 2px;
        }

        body[data-theme="OldComputer"] .time-exact {
            color: #86efac;
            font-family: 'Menlo', 'VT323', monospace;
            text-shadow: 0 0 5px rgba(74, 222, 128, 0.3);
        }

        body[data-theme="OldComputer"] .time-previous {
            color: #22c55e;
            font-family: 'Menlo', 'VT323', monospace;
            opacity: 0.7;
        }

        /* Bottom info screen */
        body[data-theme="OldComputer"] .schedule-expandable {
            background: #0a2a2a;
            margin: 0 8px 8px 8px;
            border-radius: 4px;
            border: 3px solid #072020;
        }

        body[data-theme="OldComputer"] .schedule-grid {
            padding: 10px;
            gap: 6px;
        }

        body[data-theme="OldComputer"] .time-slot {
            background: #0f3d3d;
            border: 2px solid #1a5555;
            border-radius: 4px;
            color: #4ade80;
            font-weight: 400;
            font-family: 'Menlo', 'VT323', monospace;
            text-shadow: 0 0 5px rgba(74, 222, 128, 0.3);
            letter-spacing: 1px;
        }

        body[data-theme="OldComputer"] .time-slot.next {
            background: #166534 !important;
            color: #bbf7d0;
            border: 2px solid #22c55e;
            box-shadow: 0 0 15px rgba(74, 222, 128, 0.4);
            animation: pulse-glow 1.5s infinite;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 10px rgba(74, 222, 128, 0.3);
            }

            50% {
                box-shadow: 0 0 20px rgba(74, 222, 128, 0.6);
            }
        }

        body[data-theme="OldComputer"] .time-slot.past {
            opacity: 0.3;
            color: #166534;
        }

        body[data-theme="OldComputer"] .time-slot.not-today {
            opacity: 0.15;
        }

        /* ===== BRAT THEME (Charli XCX Album Style) ===== */
        /* Ultra-minimal. Only #8ACE00 and black. Raw. Unapologetic. */
        body[data-theme="Brat"] {
            background: #8ACE00;
            /* THE brat green */
            position: relative;
            overflow-x: hidden;
        }

        body[data-theme="Brat"] .neo-box {
            background: #8ACE00 !important;
            border: 2px solid #000 !important;
            border-radius: 0 !important;
            /* Sharp like a vinyl cover */
            box-shadow: none;
            overflow: hidden;
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        body[data-theme="Brat"] .card-header {
            background: transparent;
            padding: 0;
            margin: 0 0 10px 0;
            border-bottom: none;
            width: 100%;
        }

        body[data-theme="Brat"] .card-title {
            font-family: 'HelveticaNeue-CondensedBold', 'Arial Narrow', sans-serif;
            font-weight: 700;
            color: #000;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
            letter-spacing: 0px;
            text-transform: lowercase;
            font-size: 1.5rem;
            filter: blur(0.4px);
        }

        body[data-theme="Brat"] .countdown-container {
            padding: 0;
            flex-grow: 1;
        }

        body[data-theme="Brat"] .countdown-large {
            font-family: 'HelveticaNeue-CondensedBold', 'Arial Narrow', sans-serif;
            color: #000;
            text-shadow: 0 0 15px rgba(0, 0, 0, 0.25);
            font-weight: 700;
            letter-spacing: -3px;
            filter: blur(0.3px);
        }

        body[data-theme="Brat"] .countdown-label {
            color: #000;
            font-family: 'HelveticaNeue-CondensedBold', 'Arial Narrow', Arial, sans-serif;
            font-stretch: condensed;
            font-weight: 400;
            text-shadow: 0 0 6px rgba(0, 0, 0, 0.2);
            filter: blur(0.4px);
            text-transform: lowercase;
        }

        body[data-theme="Brat"] .time-exact {
            color: #000;
            font-family: 'HelveticaNeue-CondensedBold', 'Arial Narrow', Arial, sans-serif;
            font-stretch: condensed;
            font-weight: 400;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            filter: blur(0.3px);
        }

        body[data-theme="Brat"] .time-previous {
            color: #000;
            font-family: 'HelveticaNeue-CondensedBold', 'Arial Narrow', Arial, sans-serif;
            font-stretch: condensed;
            opacity: 0.5;
            filter: blur(0.5px);
        }

        body[data-theme="Brat"] .schedule-expandable {
            background: transparent;
            border: none;
        }

        body[data-theme="Brat"] .schedule-grid {
            padding: 10px 0;
            gap: 8px;
        }

        body[data-theme="Brat"] .time-slot {
            background: transparent;
            border: 1px solid rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            color: #000;
            font-weight: 400;
            font-family: 'HelveticaNeue-CondensedBold', 'Arial Narrow', Arial, sans-serif;
            font-stretch: condensed;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.15);
            filter: blur(0.3px);
        }

        body[data-theme="Brat"] .time-slot.next {
            background: #000 !important;
            color: #8ACE00;
            border: none;
            font-weight: 700;
            filter: blur(0);
            text-shadow: none;
        }

        body[data-theme="Brat"] .time-slot.past {
            opacity: 0.25;
        }

        body[data-theme="Brat"] .time-slot.not-today {
            opacity: 0.15;
        }

        /* Remove any decorative separators */
        body[data-theme="Brat"] .schedule-expandable.open {
            border-top: none;
            margin-top: 15px;
        }

        /* ===== FLORA PUNK THEME (Pastel Green Pixel Art) ===== */
        body[data-theme="FloraPunk"] {
            background: #e4f9d5;
            /* Solid Pastel Green */
            background-attachment: fixed;
            position: relative;
            overflow-x: hidden;
        }

        /* Flora Pixel Background Decoration */
        body[data-theme="FloraPunk"]::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(rgba(0, 0, 0, 0.05) 15%, transparent 15%);
            background-size: 8px 8px;
            z-index: 0;
            pointer-events: none;
        }

        body[data-theme="FloraPunk"] .neo-box {
            background: #ffffff !important;
            border: 2px solid #1a1a2e !important;
            border-radius: 24px;
            box-shadow: 4px 4px 0 rgba(26, 26, 46, 0.1);
            overflow: hidden;
            padding: 0;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }

        body[data-theme="FloraPunk"] .card-header {
            background: #99ea66;
            /* More saturated green to contrast with background */
            padding: 15px 0;
            margin: 0;
            border-bottom: 2px solid #1a1a2e;
            width: 100%;
        }

        body[data-theme="FloraPunk"] .card-title {
            font-family: 'Marker Felt', 'Arial Black', sans-serif;
            font-weight: 900;
            color: #1a1a2e;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-size: 1.1rem;
        }

        body[data-theme="FloraPunk"] .countdown-container {
            padding: 20px;
            flex-grow: 1;
        }

        body[data-theme="FloraPunk"] .countdown-large {
            font-family: 'Marker Felt', 'Arial Black', sans-serif;
            color: #1a1a2e;
            font-weight: 900;
            letter-spacing: -2px;
        }

        body[data-theme="FloraPunk"] .countdown-label,
        body[data-theme="FloraPunk"] .time-exact {
            color: #556b2f;
            font-family: 'Marker Felt', system-ui, sans-serif;
            font-weight: 600;
        }

        body[data-theme="FloraPunk"] .time-previous {
            color: #8da36d;
            font-family: 'Marker Felt', system-ui, sans-serif;
        }

        body[data-theme="FloraPunk"] .schedule-grid {
            padding: 15px;
            gap: 10px;
        }

        body[data-theme="FloraPunk"] .time-slot {
            background: #f0fdf4;
            border: 1.5px solid #1a1a2e;
            border-radius: 12px;
            color: #1a1a2e;
            font-weight: 700;
            font-family: 'Marker Felt', system-ui, sans-serif;
        }

        body[data-theme="FloraPunk"] .time-slot.next {
            background: #1a1a2e !important;
            color: #e4f9d5;
            border: 1.5px solid #1a1a2e;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        body[data-theme="FloraPunk"] .time-slot.past {
            opacity: 0.4;
            background: #f8fafc;
        }

        body[data-theme="FloraPunk"] .time-slot.not-today {
            opacity: 0.2;
        }

        /* ===== MANGA THEME (Noir / Screen-tone Style) ===== */
        body[data-theme="Manga"] {
            background: #000000;
            position: relative;
            overflow-x: hidden;
        }

        /* Manga Panel Background Texture (Halftone dots) */
        body[data-theme="Manga"]::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(#ffffff 10%, transparent 10%);
            background-size: 20px 20px;
            opacity: 0.05;
            z-index: 0;
            pointer-events: none;
        }

        body[data-theme="Manga"] .neo-box {
            background: #ffffff !important;
            border: 6px solid #ffffff !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            padding: 0;
            overflow: hidden;
            margin-bottom: 25px;
            /* Reduced margin */
            position: relative;
        }

        body[data-theme="Manga"] .card-header {
            background: #000;
            padding: 8px 0;
            /* Reduced padding */
            margin: 0;
            border-bottom: 6px solid #ffffff;
            width: 100%;
        }

        body[data-theme="Manga"] .card-title {
            font-family: 'Arial Black', sans-serif;
            color: #ffffff;
            font-weight: 900;
            letter-spacing: 1px;
            text-shadow: none;
            display: block;
            font-size: 1.1rem;
            /* Smaller title */
        }

        body[data-theme="Manga"] .countdown-container {
            padding: 15px 10px;
            /* Reduced padding */
            background: #fff;
            text-align: center;
        }

        body[data-theme="Manga"] .countdown-large {
            font-family: 'Arial Black', sans-serif;
            color: #000;
            font-weight: 900;
            text-shadow: none;
            margin: 5px 0;
            /* Reduced margin */
            letter-spacing: -3px;
            line-height: 0.9;
            font-size: 5.5rem;
            /* Reduced size */
        }

        body[data-theme="Manga"] .countdown-label {
            color: #000;
            font-family: 'Arial Black', sans-serif;
            font-weight: 900;
            background: #a3e635;
            padding: 4px 12px;
            /* Reduced padding */
            display: table;
            margin: 0 auto 10px auto;
            text-transform: uppercase;
            font-size: 1.1rem;
            /* Smaller label */
        }

        body[data-theme="Manga"] .time-exact {
            color: #000;
            font-family: 'Courier New', monospace;
            font-weight: 900;
            background: #a3e635;
            padding: 4px 8px;
            /* Reduced padding */
            display: table;
            margin: 0 auto;
            font-size: 1rem;
            /* Smaller time */
        }

        body[data-theme="Manga"] .time-previous {
            color: #666;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            display: block;
            margin-bottom: 4px;
            /* Reduced margin */
            text-align: center;
            font-size: 0.8rem;
        }

        body[data-theme="Manga"] .schedule-grid {
            padding: 20px;
            gap: 10px;
            background-color: #f5f5f5;
            background-image: radial-gradient(#ccc 15%, transparent 15%);
            background-size: 10px 10px;
            border-top: 4px solid #000;
        }

        body[data-theme="Manga"] .time-slot {
            background: #ffffff;
            border: 3px solid #000;
            border-radius: 0;
            color: #000;
            font-weight: 900;
            font-family: 'Courier New', monospace;
            box-shadow: none;
            /* Removed shadows */
        }

        body[data-theme="Manga"] .time-slot.next {
            background: #a3e635 !important;
            border: 3px solid #000;
            color: #000;
            box-shadow: none;
            transform: none;
        }

        body[data-theme="Manga"] .time-slot.past {
            opacity: 0.5;
            box-shadow: none;
            background: #ddd;
        }

        body[data-theme="Manga"] .time-slot.not-today {
            opacity: 0.2;
            filter: grayscale(1);
        }
    </style>
</head>

<body data-theme="paladin">

    <div class="header-container">
        <div class="mascot-container">
            <!-- Checking both possible locations for safety -->
            <img id="theme-trigger" class="mascot-img" src="images/knight_mascot.png" alt="Knight Mascot"
                onerror="this.src='knight_mascot.png'">
        </div>
    </div>

    <div class="app-container">
        <!-- Card 1: To Gomel -->
        <div class="neo-box directional-card" id="card-to_gomel" data-dir="to_gomel">
            <div class="card-header">
                <span class="card-title">В ГОМЕЛЬ</span>
            </div>
            <div class="countdown-container">
                <span class="time-previous" id="prev-to_gomel">--</span>
                <span class="countdown-large" id="mins-to_gomel">--</span>
                <span class="countdown-label">МИНУТ</span>
                <span class="time-exact" id="exact-to_gomel">Выезд в --:--</span>
            </div>
            <div class="schedule-expandable" id="expand-to_gomel">
                <div class="schedule-grid" id="grid-to_gomel"></div>
            </div>
        </div>

        <!-- Card 2: From Gomel -->
        <div class="neo-box directional-card" id="card-from_gomel" data-dir="from_gomel">
            <div class="card-header">
                <span class="card-title">В КОММУНАР</span>
            </div>
            <div class="countdown-container">
                <span class="time-previous" id="prev-from_gomel">--</span>
                <span class="countdown-large" id="mins-from_gomel">--</span>
                <span class="countdown-label">МИНУТ</span>
                <span class="time-exact" id="exact-from_gomel">Выезд в --:--</span>
            </div>
            <div class="schedule-expandable" id="expand-from_gomel">
                <div class="schedule-grid" id="grid-from_gomel"></div>
            </div>
        </div>
    </div>

    <script>
        const scheduleData = {
            from_gomel: [
                { time: "06:55", days: "all" }, { time: "07:20", days: "all" }, { time: "07:35", days: "all" },
                { time: "08:10", days: "all" }, { time: "08:35", days: "all" }, { time: "09:00", days: "all" },
                { time: "09:25", days: "all" }, { time: "09:50", days: "all" }, { time: "10:15", days: "all" },
                { time: "10:55", days: "all" }, { time: "11:55", days: "all" }, { time: "12:20", days: "all" },
                { time: "13:10", days: "all" }, { time: "13:30", days: "weekends" }, { time: "13:50", days: "all" },
                { time: "14:15", days: "all" }, { time: "14:50", days: "all" }, { time: "15:15", days: "all" },
                { time: "15:40", days: "all" }, { time: "16:05", days: "all" }, { time: "16:30", days: "all" },
                { time: "16:55", days: "all" }, { time: "17:20", days: "all" }, { time: "17:45", days: "all" },
                { time: "18:10", days: "all" }, { time: "18:35", days: "all" }, { time: "19:05", days: "all" },
                { time: "19:25", days: "all" }, { time: "19:50", days: "all" }
            ],
            to_gomel: [
                { time: "05:45", days: "weekdays" }, { time: "06:25", days: "all" }, { time: "06:45", days: "all" },
                { time: "07:15", days: "all" }, { time: "07:40", days: "all" }, { time: "08:05", days: "all" },
                { time: "08:30", days: "all" }, { time: "08:55", days: "all" }, { time: "09:20", days: "all" },
                { time: "09:45", days: "all" }, { time: "10:10", days: "all" }, { time: "10:35", days: "all" },
                { time: "11:00", days: "all" }, { time: "11:50", days: "all" }, { time: "12:40", days: "all" },
                { time: "13:05", days: "all" }, { time: "13:55", days: "all" }, { time: "14:15", days: "weekends" },
                { time: "14:45", days: "all" }, { time: "15:10", days: "all" }, { time: "15:35", days: "all" },
                { time: "16:00", days: "all" }, { time: "16:25", days: "all" }, { time: "16:50", days: "all" },
                { time: "17:15", days: "all" }, { time: "17:40", days: "all" }, { time: "18:05", days: "all" },
                { time: "18:30", days: "all" }, { time: "18:55", days: "all" }, { time: "19:20", days: "all" },
                { time: "19:50", days: "all" }, { time: "20:10", days: "all" }, { time: "20:35", days: "all" }
            ]
        };

        const themes = [
            {
                name: "Paladin",
                bg: "#ffffff",
                card: "#ffffff",
                accent: "#000000",
                text: "#000000",
                bw: "5px",
                br: "0px",
                shadow: "8px",
                font: "'Courier New', Courier, monospace",
                ls: "solid",
                mascot: "images/knight_mascot.png"
            },
            {
                name: "Apple",
                bg: "#A1C4FD",
                card: "#2b5cb5",
                accent: "#ffffff",
                text: "#ffffff",
                bw: "0px",
                br: "15px",
                shadow: "0px 10px 25px rgba(0,0,0,0.3)",
                font: "'Avenir Next', 'Helvetica Neue', Arial, sans-serif",
                ls: "solid",
                mascot: "images/apple_mascot.png"
            },
            {
                name: "Punk",
                bg: "#dd89ec", /* Solid Purple */
                card: "#fabb5b", /* Orange Cards */
                accent: "#000000",
                text: "#000000",
                bw: "3px",
                br: "12px",
                shadow: "8px",
                font: "'Arial Black', 'Arial', sans-serif",
                ls: "solid",
                mascot: "images/punk_mascot.png"
            },
            {
                name: "Nokia",
                bg: "#c4d79b",
                card: "#c4d79b",
                accent: "#43523d",
                text: "#43523d",
                bw: "4px",
                br: "0px",
                shadow: "0px",
                font: "'American Typewriter', 'VT323', monospace",
                ls: "solid",
                mascot: "images/nokia_mascot.png"
            },
            {
                name: "Aero",
                bg: "#87CEEB",
                card: "rgba(0, 191, 255, 0.9)",
                accent: "#32CD32",
                text: "#ffffff",
                bw: "3px",
                br: "25px",
                shadow: "0 15px 35px rgba(0, 50, 100, 0.4)",
                font: "'Gill Sans', 'Trebuchet MS', sans-serif",
                ls: "solid",
                mascot: "images/glass_mascot.png"
            },
            {
                name: "Raskraska",
                bg: "#fff0db",
                card: "#fabb5b",
                accent: "#1a1a2e",
                text: "#1a1a2e",
                bw: "4px",
                br: "20px",
                shadow: "6px 6px 0 #1a1a2e",
                font: "'Chalkboard SE', 'Comic Sans MS', cursive, sans-serif",
                ls: "solid",
                mascot: "images/color_mascot.png"
            },
            {
                name: "OldComputer",
                bg: "#1a1040",
                card: "#6b5b95",
                accent: "#4ade80",
                text: "#4ade80",
                bw: "4px",
                br: "8px",
                shadow: "4px 4px 0 rgba(0,0,0,0.5)",
                font: "'Menlo', 'VT323', 'Courier New', monospace",
                ls: "solid",
                mascot: "images/computar_mascot.png"
            },
            {
                name: "Brat",
                bg: "#8ACE00",
                card: "#8ACE00",
                accent: "#000000",
                text: "#000000",
                bw: "0px",
                br: "0px",
                shadow: "none",
                font: "Arial, Helvetica, sans-serif",
                ls: "solid",
                mascot: "images/brat_mascot.png"
            },
            {
                name: "FloraPunk",
                bg: "#e4f9d5",
                card: "#ffffff",
                accent: "#1a1a2e",
                text: "#1a1a2e",
                bw: "2px",
                br: "24px",
                shadow: "4px 4px 0 rgba(26, 26, 46, 0.1)",
                font: "'Marker Felt', 'Arial Black', sans-serif",
                ls: "solid",
                mascot: "images/flora_mascot.png"
            },
            {
                name: "Manga",
                bg: "#000000",
                card: "#ffffff",
                accent: "#a3e635",
                text: "#000000",
                bw: "6px",
                br: "0px",
                shadow: "none",
                font: "'Arial Black', sans-serif",
                ls: "solid",
                mascot: "images/manga_mascot.png"
            }
        ];

        function applyTheme(theme) {
            const root = document.documentElement;
            // Apply background to both html and body to prevent white bars in Safari
            document.documentElement.style.background = theme.bg;
            document.body.style.background = theme.bg;
            document.body.style.backgroundAttachment = 'fixed'; // Keep fixed background

            if (theme.name !== "Punk" && theme.name !== "Nokia" && theme.name !== "Aero" && theme.name !== "Raskraska" && theme.name !== "OldComputer" && theme.name !== "Brat" && theme.name !== "FloraPunk" && theme.name !== "Manga") {
                // Already handled above, but keeping for compatibility
            }

            root.style.setProperty('--card-bg', theme.card);
            root.style.setProperty('--accent-color', theme.accent);
            root.style.setProperty('--text-color', theme.text);
            root.style.setProperty('--border-width', theme.bw);
            root.style.setProperty('--border-radius', theme.br);
            root.style.setProperty('--shadow-offset', theme.shadow);
            root.style.setProperty('--font-main', theme.font);
            root.style.setProperty('--line-style', theme.ls);

            // Set Data Attribute for CSS Overrides
            document.body.setAttribute('data-theme', theme.name);

            // Switch Mascot
            const mascotImg = document.getElementById('theme-trigger');
            if (mascotImg && theme.mascot) {
                mascotImg.src = theme.mascot;
            }
        }

        function isRunning(item, now) {
            const day = now.getDay();
            const isWE = (day === 0 || day === 6);
            if (item.days === 'all') return true;
            if (item.days === 'weekdays') return !isWE;
            if (item.days === 'weekends') return isWE;
            return false;
        }

        function getDayLabel(code) {
            if (code === 'weekdays') return '(пн-пт)';
            if (code === 'weekends') return '(сб, вс)';
            return '';
        }

        function getInflectedMinutes(number) {
            number = Math.abs(number) % 100;
            const n1 = number % 10;
            if (number > 10 && number < 20) return 'МИНУТ';
            if (n1 > 1 && n1 < 5) return 'МИНУТЫ';
            if (n1 === 1) return 'МИНУТА';
            return 'МИНУТ';
        }

        function updateCard(dir) {
            const now = new Date();
            const currentMins = now.getHours() * 60 + now.getMinutes();

            // Get all items but mark them
            const allItems = scheduleData[dir];
            const runningItems = allItems.filter(i => isRunning(i, now));

            const grid = document.getElementById(`grid-${dir}`);
            const minsEl = document.getElementById(`mins-${dir}`);
            const exactEl = document.getElementById(`exact-${dir}`);
            const prevEl = document.getElementById(`prev-${dir}`);

            let nextBus = null;
            let prevBus = null;

            // 1. Find Next and Previous bus based on Running items only
            // Sort running items by time
            const sortedRunning = [...runningItems].sort((a, b) => {
                const [hA, mA] = a.time.split(':').map(Number);
                const [hB, mB] = b.time.split(':').map(Number);
                return (hA * 60 + mA) - (hB * 60 + mB);
            });

            for (let i = 0; i < sortedRunning.length; i++) {
                const item = sortedRunning[i];
                const [h, m] = item.time.split(':').map(Number);
                const bMins = h * 60 + m;

                if (bMins < currentMins) {
                    prevBus = { ...item, mins: bMins };
                } else if (bMins >= currentMins && !nextBus) {
                    nextBus = { ...item, mins: bMins };
                }
            }

            // Fallback: If no previous bus today, check yesterday's last bus
            if (!prevBus) {
                const yesterday = new Date(now);
                yesterday.setDate(now.getDate() - 1);
                const yesterdayRunning = allItems.filter(i => isRunning(i, yesterday));
                if (yesterdayRunning.length > 0) {
                    yesterdayRunning.sort((a, b) => {
                        const [hA, mA] = a.time.split(':').map(Number);
                        const [hB, mB] = b.time.split(':').map(Number);
                        return (hA * 60 + mA) - (hB * 60 + mB);
                    });
                    const lastYesterday = yesterdayRunning[yesterdayRunning.length - 1];
                    const [h, m] = lastYesterday.time.split(':').map(Number);
                    prevBus = { ...lastYesterday, mins: h * 60 + m, isYesterday: true };
                }
            }

            // 2. Render Full Grid
            grid.innerHTML = '';
            // We want the grid to be sorted by time naturally
            // scheduleData is already roughly sorted but let's be safe or just map original
            allItems.forEach(item => {
                const [h, m] = item.time.split(':').map(Number);
                const bMins = h * 60 + m;
                const activeToday = isRunning(item, now);

                const el = document.createElement('div');
                el.className = 'time-slot';

                // Add Day Label if needed
                const label = getDayLabel(item.days);
                el.innerHTML = `<span>${item.time}</span>${label ? `<span class="slot-day-label">${label}</span>` : ''}`;

                if (!activeToday) {
                    el.classList.add('not-today');
                } else {
                    if (bMins < currentMins) {
                        el.classList.add('past');
                    } else if (nextBus && item.time === nextBus.time) {
                        el.classList.add('next');
                    }
                }
                grid.appendChild(el);
            });

            // 3. Update Big Card Info
            if (nextBus) {
                const diff = nextBus.mins - currentMins;
                minsEl.textContent = diff;

                // Update label with inflection
                const label = getInflectedMinutes(diff);
                const container = minsEl.parentElement;
                const labelEl = container.querySelector('.countdown-label');
                if (labelEl) labelEl.textContent = label;

                const dayLabel = getDayLabel(nextBus.days);
                exactEl.textContent = `Выезд в ${nextBus.time} ${dayLabel}`;
            } else {
                minsEl.textContent = "--";
                exactEl.textContent = "Рейсов больше нет";
            }

            if (prevBus) {
                let ago;
                if (prevBus.isYesterday) {
                    ago = (1440 - prevBus.mins) + currentMins;
                } else {
                    ago = currentMins - prevBus.mins;
                }

                let agoStr;
                if (ago >= 60) {
                    const hAgo = Math.floor(ago / 60);
                    const mAgo = ago % 60;
                    agoStr = `${hAgo} ч. ${mAgo} мин. назад`;
                } else {
                    agoStr = `${ago} мин. назад`;
                }

                prevEl.textContent = `Прошлая: ${prevBus.time} (${agoStr})`;
            } else {
                prevEl.textContent = "";
            }
        }

        function updateAll() {
            updateCard('from_gomel');
            updateCard('to_gomel');
        }

        document.querySelectorAll('.directional-card').forEach(card => {
            card.onclick = () => {
                const dir = card.dataset.dir;
                document.getElementById(`expand-${dir}`).classList.toggle('open');
            };
        });

        function setRandomTheme() {
            const current = document.body.dataset.themeIndex || -1;
            let next = Math.floor(Math.random() * themes.length);
            if (themes.length > 1) {
                while (next == current) next = Math.floor(Math.random() * themes.length);
            }

            const mascotImg = document.getElementById('theme-trigger');
            if (mascotImg) {
                mascotImg.classList.remove('mascot-animate');
                void mascotImg.offsetWidth; // Trigger reflow
                mascotImg.classList.add('mascot-animate');
            }

            document.body.dataset.themeIndex = next;
            applyTheme(themes[next]);
        }

        document.getElementById('theme-trigger').onclick = setRandomTheme;

        // Initialize single theme
        setRandomTheme();

        setInterval(updateAll, 10000);
        updateAll();
    </script>
</body>

</html>